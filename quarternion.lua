-- title:  game title
-- author: game developer
-- desc:   short description
-- script: lua

-- center of scene
center = {0, 0, 300}

-- distance to screen (depth)
d = 300
-- center of rotation
pivot = {0, 0, 0}
angle = 0
points = {}

sqrt = math.sqrt
cos = math.cos
sin = math.sin
abs = math.abs
floor = math.floor

function norm(v)
	return sqrt(v[1]*v[1] + v[2]*v[2] + v[3]*v[3])
end

function normalise(v)
	local r = norm(v)
	return scale(1/r, v)
end

function add(u, v)
	return {u[1]+v[1], u[2]+v[2], u[3]+v[3]}
end

function scale(k, v)
	return {k*v[1], k*v[2], k*v[3]}
end

function cross(u, v)
	return {u[2]*v[3]-v[2]*u[3], v[1]*u[3]-u[1]*v[3], u[1]*v[2]-v[1]*u[2]}
end

function dot(u, v)
	return u[1]*v[1] + u[2]*v[2] + u[3]*v[3]
end

function rotateQuarternion(p3d, pivot, axis, angle)
	local p = p3d.v
	local c = cos(angle/2)
	local s = sin(angle/2)
	local u = scale(s, axis)

	local k = dot(u, p)
	local w = cross(u, p)

	p3d.v = add(add(scale(2*k, u), scale(c*c-s*s, p)), scale(2*c, w))
end

function createCube()
	points = {}
	local l = 5
	local p 
	for x = -3,3 do
		for y = -3,3 do
			for z = -3,3 do
				p = {
					v = scale(l, {x, y, z}),
					c = abs(x+y+z)
				}
				table.insert(points, p)
			end
		end
	end
end

function p2d(p3d)
	local v0 = add(p3d.v, center) 
	local x2d = d * v0[1] / v0[3]
	local y2d = d * v0[2] / v0[3]
	
	return x2d, y2d
end

function zsort(p1, p2)
	return p1.v[3] > p2.v[3]
end

function TIC()
	
	cls(10)

	-- createCube()
	createTeapot()

	for k,p in pairs(points) do
		rotateQuarternion(p, pivot, normalise({1, 0, 1}), 1.57)
		rotateQuarternion(p, pivot, {0, 1, 0}, angle)
	end

	table.sort(points, zsort)

	for k,p in pairs(points) do
		i, j = p2d(p)
		rect(p.v[1] + 120, p.v[2] + 68, 6, 6, p.c)
	end

	angle = angle + 0.05
end

function createTeapot()
	points = {
		{v={ 1.4000, 0.0000, 2.4000},c=0},
		{v={ 1.4000,-0.7840, 2.4000},c=0},
		{v={ 0.7800,-1.4000, 2.4000},c=0},
		{v={ 0.0000,-1.4000, 2.4000},c=0},
		{v={ 1.3375, 0.0000, 2.5312},c=0},
		{v={ 1.3375,-0.7490, 2.5312},c=0},
		{v={ 0.7490,-1.3375, 2.5312},c=0},
		{v={ 0.0000,-1.3375, 2.5312},c=0},
		{v={ 1.4375, 0.0000, 2.5312},c=0},
		{v={ 1.4375,-0.8050, 2.5312},c=0},
		{v={ 0.8050,-1.4375, 2.5312},c=0},
		{v={ 0.0000,-1.4375, 2.5312},c=0},
		{v={ 1.5000, 0.0000, 2.4000},c=0},
		{v={ 1.5000,-0.8400, 2.4000},c=0},
		{v={ 0.8400,-1.5000, 2.4000},c=0},
		{v={ 0.0000,-1.5000, 2.4000},c=0},
		{v={-0.7840,-1.4000, 2.4000},c=0},
		{v={-1.4000,-0.7840, 2.4000},c=0},
		{v={-1.4000, 0.0000, 2.4000},c=0},
		{v={-0.7490,-1.3375, 2.5312},c=0},
		{v={-1.3375,-0.7490, 2.5312},c=0},
		{v={-1.3375, 0.0000, 2.5312},c=0},
		{v={-0.8050,-1.4375, 2.5312},c=0},
		{v={-1.4375,-0.8050, 2.5312},c=0},
		{v={-1.4375, 0.0000, 2.5312},c=0},
		{v={-0.8400,-1.5000, 2.4000},c=0},
		{v={-1.5000,-0.8400, 2.4000},c=0},
		{v={-1.5000, 0.0000, 2.4000},c=0},
		{v={-1.4000, 0.7840, 2.4000},c=0},
		{v={-0.7840, 1.4000, 2.4000},c=0},
		{v={ 0.0000, 1.4000, 2.4000},c=0},
		{v={-1.3375, 0.7490, 2.5312},c=0},
		{v={-0.7490, 1.3375, 2.5312},c=0},
		{v={ 0.0000, 1.3375, 2.5312},c=0},
		{v={-1.4375, 0.8050, 2.5312},c=0},
		{v={-0.8050, 1.4375, 2.5312},c=0},
		{v={ 0.0000, 1.4375, 2.5312},c=0},
		{v={-1.5000, 0.8400, 2.4000},c=0},
		{v={-0.8400, 1.5000, 2.4000},c=0},
		{v={ 0.0000, 1.5000, 2.4000},c=0},
		{v={ 0.7840, 1.4000, 2.4000},c=0},
		{v={ 1.4000, 0.7840, 2.4000},c=0},
		{v={ 0.7490, 1.3375, 2.5312},c=0},
		{v={ 1.3375, 0.7490, 2.5312},c=0},
		{v={ 0.8050, 1.4375, 2.5312},c=0},
		{v={ 1.4375, 0.8050, 2.5312},c=0},
		{v={ 0.8400, 1.5000, 2.4000},c=0},
		{v={ 1.5000, 0.8400, 2.4000},c=0},
		{v={ 1.7500, 0.0000, 1.8750},c=0},
		{v={ 1.7500,-0.9800, 1.8750},c=0},
		{v={ 0.9800,-1.7500, 1.8750},c=0},
		{v={ 0.0000,-1.7500, 1.8750},c=0},
		{v={ 2.0000, 0.0000, 1.3500},c=0},
		{v={ 2.0000,-1.1200, 1.3500},c=0},
		{v={ 1.1200,-2.0000, 1.3500},c=0},
		{v={ 0.0000,-2.0000, 1.3500},c=0},
		{v={ 2.0000, 0.0000, 0.9000},c=0},
		{v={ 2.0000,-1.1200, 0.9000},c=0},
		{v={ 1.1200,-2.0000, 0.9000},c=0},
		{v={ 0.0000,-2.0000, 0.9000},c=0},
		{v={-0.9800,-1.7500, 1.8750},c=0},
		{v={-1.7500,-0.9800, 1.8750},c=0},
		{v={-1.7500, 0.0000, 1.8750},c=0},
		{v={-1.1200,-2.0000, 1.3500},c=0},
		{v={-2.0000,-1.1200, 1.3500},c=0},
		{v={-2.0000, 0.0000, 1.3500},c=0},
		{v={-1.1200,-2.0000, 0.9000},c=0},
		{v={-2.0000,-1.1200, 0.9000},c=0},
		{v={-2.0000, 0.0000, 0.9000},c=0},
		{v={-1.7500, 0.9800, 1.8750},c=0},
		{v={-0.9800, 1.7500, 1.8750},c=0},
		{v={ 0.0000, 1.7500, 1.8750},c=0},
		{v={-2.0000, 1.1200, 1.3500},c=0},
		{v={-1.1200, 2.0000, 1.3500},c=0},
		{v={ 0.0000, 2.0000, 1.3500},c=0},
		{v={-2.0000, 1.1200, 0.9000},c=0},
		{v={-1.1200, 2.0000, 0.9000},c=0},
		{v={ 0.0000, 2.0000, 0.9000},c=0},
		{v={ 0.9800, 1.7500, 1.8750},c=0},
		{v={ 1.7500, 0.9800, 1.8750},c=0},
		{v={ 1.1200, 2.0000, 1.3500},c=0},
		{v={ 2.0000, 1.1200, 1.3500},c=0},
		{v={ 1.1200, 2.0000, 0.9000},c=0},
		{v={ 2.0000, 1.1200, 0.9000},c=0},
		{v={ 2.0000, 0.0000, 0.4500},c=0},
		{v={ 2.0000,-1.1200, 0.4500},c=0},
		{v={ 1.1200,-2.0000, 0.4500},c=0},
		{v={ 0.0000,-2.0000, 0.4500},c=0},
		{v={ 1.5000, 0.0000, 0.2250},c=0},
		{v={ 1.5000,-0.8400, 0.2250},c=0},
		{v={ 0.8400,-1.5000, 0.2250},c=0},
		{v={ 0.0000,-1.5000, 0.2250},c=0},
		{v={ 1.5000, 0.0000, 0.1500},c=0},
		{v={ 1.5000,-0.8400, 0.1500},c=0},
		{v={ 0.8400,-1.5000, 0.1500},c=0},
		{v={ 0.0000,-1.5000, 0.1500},c=0},
		{v={-1.1200,-2.0000, 0.4500},c=0},
		{v={-2.0000,-1.1200, 0.4500},c=0},
		{v={-2.0000, 0.0000, 0.4500},c=0},
		{v={-0.8400,-1.5000, 0.2250},c=0},
		{v={-1.5000,-0.8400, 0.2250},c=0},
		{v={-1.5000, 0.0000, 0.2250},c=0},
		{v={-0.8400,-1.5000, 0.1500},c=0},
		{v={-1.5000,-0.8400, 0.1500},c=0},
		{v={-1.5000, 0.0000, 0.1500},c=0},
		{v={-2.0000, 1.1200, 0.4500},c=0},
		{v={-1.1200, 2.0000, 0.4500},c=0},
		{v={ 0.0000, 2.0000, 0.4500},c=0},
		{v={-1.5000, 0.8400, 0.2250},c=0},
		{v={-0.8400, 1.5000, 0.2250},c=0},
		{v={ 0.0000, 1.5000, 0.2250},c=0},
		{v={-1.5000, 0.8400, 0.1500},c=0},
		{v={-0.8400, 1.5000, 0.1500},c=0},
		{v={ 0.0000, 1.5000, 0.1500},c=0},
		{v={ 1.1200, 2.0000, 0.4500},c=0},
		{v={ 2.0000, 1.1200, 0.4500},c=0},
		{v={ 0.8400, 1.5000, 0.2250},c=0},
		{v={ 1.5000, 0.8400, 0.2250},c=0},
		{v={ 0.8400, 1.5000, 0.1500},c=0},
		{v={ 1.5000, 0.8400, 0.1500},c=0},
		{v={-1.6000, 0.0000, 2.0250},c=0},
		{v={-1.6000,-0.3000, 2.0250},c=0},
		{v={-1.5000,-0.3000, 2.2500},c=0},
		{v={-1.5000, 0.0000, 2.2500},c=0},
		{v={-2.3000, 0.0000, 2.0250},c=0},
		{v={-2.3000,-0.3000, 2.0250},c=0},
		{v={-2.5000,-0.3000, 2.2500},c=0},
		{v={-2.5000, 0.0000, 2.2500},c=0},
		{v={-2.7000, 0.0000, 2.0250},c=0},
		{v={-2.7000,-0.3000, 2.0250},c=0},
		{v={-3.0000,-0.3000, 2.2500},c=0},
		{v={-3.0000, 0.0000, 2.2500},c=0},
		{v={-2.7000, 0.0000, 1.8000},c=0},
		{v={-2.7000,-0.3000, 1.8000},c=0},
		{v={-3.0000,-0.3000, 1.8000},c=0},
		{v={-3.0000, 0.0000, 1.8000},c=0},
		{v={-1.5000, 0.3000, 2.2500},c=0},
		{v={-1.6000, 0.3000, 2.0250},c=0},
		{v={-2.5000, 0.3000, 2.2500},c=0},
		{v={-2.3000, 0.3000, 2.0250},c=0},
		{v={-3.0000, 0.3000, 2.2500},c=0},
		{v={-2.7000, 0.3000, 2.0250},c=0},
		{v={-3.0000, 0.3000, 1.8000},c=0},
		{v={-2.7000, 0.3000, 1.8000},c=0},
		{v={-2.7000, 0.0000, 1.5750},c=0},
		{v={-2.7000,-0.3000, 1.5750},c=0},
		{v={-3.0000,-0.3000, 1.3500},c=0},
		{v={-3.0000, 0.0000, 1.3500},c=0},
		{v={-2.5000, 0.0000, 1.1250},c=0},
		{v={-2.5000,-0.3000, 1.1250},c=0},
		{v={-2.6500,-0.3000, 0.9375},c=0},
		{v={-2.6500, 0.0000, 0.9375},c=0},
		{v={-2.0000,-0.3000, 0.9000},c=0},
		{v={-1.9000,-0.3000, 0.6000},c=0},
		{v={-1.9000, 0.0000, 0.6000},c=0},
		{v={-3.0000, 0.3000, 1.3500},c=0},
		{v={-2.7000, 0.3000, 1.5750},c=0},
		{v={-2.6500, 0.3000, 0.9375},c=0},
		{v={-2.5000, 0.3000, 1.1250},c=0},
		{v={-1.9000, 0.3000, 0.6000},c=0},
		{v={-2.0000, 0.3000, 0.9000},c=0},
		{v={ 1.7000, 0.0000, 1.4250},c=0},
		{v={ 1.7000,-0.6600, 1.4250},c=0},
		{v={ 1.7000,-0.6600, 0.6000},c=0},
		{v={ 1.7000, 0.0000, 0.6000},c=0},
		{v={ 2.6000, 0.0000, 1.4250},c=0},
		{v={ 2.6000,-0.6600, 1.4250},c=0},
		{v={ 3.1000,-0.6600, 0.8250},c=0},
		{v={ 3.1000, 0.0000, 0.8250},c=0},
		{v={ 2.3000, 0.0000, 2.1000},c=0},
		{v={ 2.3000,-0.2500, 2.1000},c=0},
		{v={ 2.4000,-0.2500, 2.0250},c=0},
		{v={ 2.4000, 0.0000, 2.0250},c=0},
		{v={ 2.7000, 0.0000, 2.4000},c=0},
		{v={ 2.7000,-0.2500, 2.4000},c=0},
		{v={ 3.3000,-0.2500, 2.4000},c=0},
		{v={ 3.3000, 0.0000, 2.4000},c=0},
		{v={ 1.7000, 0.6600, 0.6000},c=0},
		{v={ 1.7000, 0.6600, 1.4250},c=0},
		{v={ 3.1000, 0.6600, 0.8250},c=0},
		{v={ 2.6000, 0.6600, 1.4250},c=0},
		{v={ 2.4000, 0.2500, 2.0250},c=0},
		{v={ 2.3000, 0.2500, 2.1000},c=0},
		{v={ 3.3000, 0.2500, 2.4000},c=0},
		{v={ 2.7000, 0.2500, 2.4000},c=0},
		{v={ 2.8000, 0.0000, 2.4750},c=0},
		{v={ 2.8000,-0.2500, 2.4750},c=0},
		{v={ 3.5250,-0.2500, 2.4937},c=0},
		{v={ 3.5250, 0.0000, 2.4937},c=0},
		{v={ 2.9000, 0.0000, 2.4750},c=0},
		{v={ 2.9000,-0.1500, 2.4750},c=0},
		{v={ 3.4500,-0.1500, 2.5125},c=0},
		{v={ 3.4500, 0.0000, 2.5125},c=0},
		{v={ 2.8000, 0.0000, 2.4000},c=0},
		{v={ 2.8000,-0.1500, 2.4000},c=0},
		{v={ 3.2000,-0.1500, 2.4000},c=0},
		{v={ 3.2000, 0.0000, 2.4000},c=0},
		{v={ 3.5250, 0.2500, 2.4937},c=0},
		{v={ 2.8000, 0.2500, 2.4750},c=0},
		{v={ 3.4500, 0.1500, 2.5125},c=0},
		{v={ 2.9000, 0.1500, 2.4750},c=0},
		{v={ 3.2000, 0.1500, 2.4000},c=0},
		{v={ 2.8000, 0.1500, 2.4000},c=0},
		{v={ 0.0000, 0.0000, 3.1500},c=0},
		{v={ 0.0000,-0.0020, 3.1500},c=0},
		{v={ 0.0020, 0.0000, 3.1500},c=0},
		{v={ 0.8000, 0.0000, 3.1500},c=0},
		{v={ 0.8000,-0.4500, 3.1500},c=0},
		{v={ 0.4500,-0.8000, 3.1500},c=0},
		{v={ 0.0000,-0.8000, 3.1500},c=0},
		{v={ 0.0000, 0.0000, 2.8500},c=0},
		{v={ 0.2000, 0.0000, 2.7000},c=0},
		{v={ 0.2000,-0.1120, 2.7000},c=0},
		{v={ 0.1120,-0.2000, 2.7000},c=0},
		{v={ 0.0000,-0.2000, 2.7000},c=0},
		{v={-0.0020, 0.0000, 3.1500},c=0},
		{v={-0.4500,-0.8000, 3.1500},c=0},
		{v={-0.8000,-0.4500, 3.1500},c=0},
		{v={-0.8000, 0.0000, 3.1500},c=0},
		{v={-0.1120,-0.2000, 2.7000},c=0},
		{v={-0.2000,-0.1120, 2.7000},c=0},
		{v={-0.2000, 0.0000, 2.7000},c=0},
		{v={ 0.0000, 0.0020, 3.1500},c=0},
		{v={-0.8000, 0.4500, 3.1500},c=0},
		{v={-0.4500, 0.8000, 3.1500},c=0},
		{v={ 0.0000, 0.8000, 3.1500},c=0},
		{v={-0.2000, 0.1120, 2.7000},c=0},
		{v={-0.1120, 0.2000, 2.7000},c=0},
		{v={ 0.0000, 0.2000, 2.7000},c=0},
		{v={ 0.4500, 0.8000, 3.1500},c=0},
		{v={ 0.8000, 0.4500, 3.1500},c=0},
		{v={ 0.1120, 0.2000, 2.7000},c=0},
		{v={ 0.2000, 0.1120, 2.7000},c=0},
		{v={ 0.4000, 0.0000, 2.5500},c=0},
		{v={ 0.4000,-0.2240, 2.5500},c=0},
		{v={ 0.2240,-0.4000, 2.5500},c=0},
		{v={ 0.0000,-0.4000, 2.5500},c=0},
		{v={ 1.3000, 0.0000, 2.5500},c=0},
		{v={ 1.3000,-0.7280, 2.5500},c=0},
		{v={ 0.7280,-1.3000, 2.5500},c=0},
		{v={ 0.0000,-1.3000, 2.5500},c=0},
		{v={ 1.3000, 0.0000, 2.4000},c=0},
		{v={ 1.3000,-0.7280, 2.4000},c=0},
		{v={ 0.7280,-1.3000, 2.4000},c=0},
		{v={ 0.0000,-1.3000, 2.4000},c=0},
		{v={-0.2240,-0.4000, 2.5500},c=0},
		{v={-0.4000,-0.2240, 2.5500},c=0},
		{v={-0.4000, 0.0000, 2.5500},c=0},
		{v={-0.7280,-1.3000, 2.5500},c=0},
		{v={-1.3000,-0.7280, 2.5500},c=0},
		{v={-1.3000, 0.0000, 2.5500},c=0},
		{v={-0.7280,-1.3000, 2.4000},c=0},
		{v={-1.3000,-0.7280, 2.4000},c=0},
		{v={-1.3000, 0.0000, 2.4000},c=0},
		{v={-0.4000, 0.2240, 2.5500},c=0},
		{v={-0.2240, 0.4000, 2.5500},c=0},
		{v={ 0.0000, 0.4000, 2.5500},c=0},
		{v={-1.3000, 0.7280, 2.5500},c=0},
		{v={-0.7280, 1.3000, 2.5500},c=0},
		{v={ 0.0000, 1.3000, 2.5500},c=0},
		{v={-1.3000, 0.7280, 2.4000},c=0},
		{v={-0.7280, 1.3000, 2.4000},c=0},
		{v={ 0.0000, 1.3000, 2.4000},c=0},
		{v={ 0.2240, 0.4000, 2.5500},c=0},
		{v={ 0.4000, 0.2240, 2.5500},c=0},
		{v={ 0.7280, 1.3000, 2.5500},c=0},
		{v={ 1.3000, 0.7280, 2.5500},c=0},
		{v={ 0.7280, 1.3000, 2.4000},c=0},
		{v={ 1.3000, 0.7280, 2.4000},c=0},
		{v={ 0.0000, 0.0000, 0.0000},c=0},
		{v={ 1.5000, 0.0000, 0.1500},c=0},
		{v={ 1.5000, 0.8400, 0.1500},c=0},
		{v={ 0.8400, 1.5000, 0.1500},c=0},
		{v={ 0.0000, 1.5000, 0.1500},c=0},
		{v={ 1.5000, 0.0000, 0.0750},c=0},
		{v={ 1.5000, 0.8400, 0.0750},c=0},
		{v={ 0.8400, 1.5000, 0.0750},c=0},
		{v={ 0.0000, 1.5000, 0.0750},c=0},
		{v={ 1.4250, 0.0000, 0.0000},c=0},
		{v={ 1.4250, 0.7980, 0.0000},c=0},
		{v={ 0.7980, 1.4250, 0.0000},c=0},
		{v={ 0.0000, 1.4250, 0.0000},c=0},
		{v={-0.8400, 1.5000, 0.1500},c=0},
		{v={-1.5000, 0.8400, 0.1500},c=0},
		{v={-1.5000, 0.0000, 0.1500},c=0},
		{v={-0.8400, 1.5000, 0.0750},c=0},
		{v={-1.5000, 0.8400, 0.0750},c=0},
		{v={-1.5000, 0.0000, 0.0750},c=0},
		{v={-0.7980, 1.4250, 0.0000},c=0},
		{v={-1.4250, 0.7980, 0.0000},c=0},
		{v={-1.4250, 0.0000, 0.0000},c=0},
		{v={-1.5000,-0.8400, 0.1500},c=0},
		{v={-0.8400,-1.5000, 0.1500},c=0},
		{v={ 0.0000,-1.5000, 0.1500},c=0},
		{v={-1.5000,-0.8400, 0.0750},c=0},
		{v={-0.8400,-1.5000, 0.0750},c=0},
		{v={ 0.0000,-1.5000, 0.0750},c=0},
		{v={-1.4250,-0.7980, 0.0000},c=0},
		{v={-0.7980,-1.4250, 0.0000},c=0},
		{v={ 0.0000,-1.4250, 0.0000},c=0},
		{v={ 0.8400,-1.5000, 0.1500},c=0},
		{v={ 1.5000,-0.8400, 0.1500},c=0},
		{v={ 0.8400,-1.5000, 0.0750},c=0},
		{v={ 1.5000,-0.8400, 0.0750},c=0},
		{v={ 0.7980,-1.4250, 0.0000},c=0},
		{v={ 1.4250,-0.7980, 0.0000},c=0}
	}
	for k,p in pairs(points) do
		p.c = abs(floor(p.v[1]+4))
		p.v[3] = p.v[3]-1.5
		p.v = scale(20, p.v)
	end
end